{"version":3,"sources":["test/dependencies.test.ts"],"names":[],"mappings":"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","file":"dependencies.test.js","sourcesContent":["import * as request from 'request-promise'\nimport {Agent} from 'http'\nimport {Suite, Test, SuiteSetup, SuiteTeardown, Setup, Teardown, TestContainer} from 'jest-decorators'\nimport {ApplicationScope, SessionScope, RequestScope, Scope, ProviderContainer} from '@webnode/cdi'\nimport {HttpServer, ServerRequest, ServerResponse, RePathnameParams} from '..'\nimport {Controller, Get, Post, Put, Delete, Head, Options, Trace, Connect} from '..'\nimport {ParameterMapping, Req, Res, Uri, Headers, Params, Query, ReqBody} from '..'\nimport {RequestLifecycle, RequestStart, RequestEnd, RequestError} from '..'\n\nclass A {\n  value = 0\n}\n\n@Controller\nclass Home {\n  constructor(\n    @ApplicationScope('a') private a: A,\n    @SessionScope('a') private b: A,\n    @RequestScope('a') private c: A\n  ) {\n  }\n\n  @Get('/app')\n  private getApp(@Res() res: ServerResponse) {\n    if (this.a !== undefined) {\n      this.a.value = 100\n    }\n    if (this.b !== undefined) {\n      this.b.value = 100\n    }\n    if (this.c !== undefined) {\n      this.c.value = 100\n    }\n  }\n\n  @Get('/')\n  private get(@Res() res: ServerResponse) {\n    res.body = {\n      a: this.a,\n      b: this.b,\n      c: this.c\n    }\n  }\n}\n\n@Suite\nclass ServerTest {\n  private app: HttpServer\n  private port: number\n  private agent: Agent\n\n  @SuiteSetup\n  private async suiteSetup() {\n    ProviderContainer.instance.set(Scope.APPLICATION, 'a', () => new A)\n    ProviderContainer.instance.set(Scope.SESSION,     'a', () => new A)\n    ProviderContainer.instance.set(Scope.REQUEST,     'a', () => new A)\n\n    this.agent = new Agent({keepAlive:true})\n    this.app = HttpServer.create()\n    await this.app.serve()\n    this.port = this.app.address().port\n  }\n\n  @SuiteTeardown\n  private async teardown() {\n    await this.app.close()\n    this.agent.destroy()\n    ProviderContainer.instance.delete(Scope.APPLICATION, 'a')\n    ProviderContainer.instance.delete(Scope.SESSION,     'a')\n    ProviderContainer.instance.delete(Scope.REQUEST,     'a')\n  }\n\n  @Test\n  private async get() {\n    await request.get(`http://127.0.0.1:${this.port}/app`, {resolveWithFullResponse: true, json: true, agent: this.agent})\n    let res = await request.get(`http://127.0.0.1:${this.port}/`, {resolveWithFullResponse: true, json: true, agent: this.agent})\n    expect(res.body.a.value).toBe(100)\n    expect(res.body.b.value).toBe(100)\n    expect(res.body.c).toBe(undefined)\n  }\n}\n\nTestContainer.run()"]}