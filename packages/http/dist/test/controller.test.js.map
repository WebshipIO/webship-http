{"version":3,"sources":["test/controller.test.ts"],"names":[],"mappings":"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","file":"controller.test.js","sourcesContent":["import * as request from 'request-promise'\nimport {Suite, Test, SuiteSetup, SuiteTeardown, Setup, Teardown, TestContainer} from 'jest-decorators'\nimport {ApplicationScope, SessionScope, RequestScope, Scope, ProviderContainer} from '@webnode/cdi'\nimport {HttpServer, ServerRequest, ServerResponse, RePathnameParams} from '..'\nimport {Controller, Get, Post, Put, Delete, Head, Options, Trace, Connect} from '..'\nimport {ParameterMapping, Req, Res, Url, Headers, Params, Query, ReqBody} from '..'\nimport {RequestLifecycle, RequestStart, RequestEnd, RequestError} from '..'\n\ninterface UpdateBody {\n  value: number\n}\n\ninterface TraceBody {\n  value: number\n}\n\n@Controller\nclass Home {\n  @Post('/')\n  private create(@Res res: ServerResponse) {\n    res.status = 201\n  }\n\n  @Get('/:id')\n  private get(@Res res: ServerResponse, @Params params: RePathnameParams) {\n    res.body = {id: parseInt(params.id)}\n  }\n\n  @Put('/:id/value')\n  private update(@Res res: ServerResponse, @Params params: RePathnameParams, @ReqBody body: UpdateBody) {\n    res.body = {value: body.value}\n  }\n\n  @Delete('/:id')\n  private delete(@Res res: ServerResponse, @Params params: RePathnameParams) {\n    res.body = {id: 0}\n  }\n\n  @Head('/')\n  private head(@Res res: ServerResponse, @Params params: RePathnameParams) {\n    res.status = 204\n  }\n\n  @Options('/')\n  private options(@Res res: ServerResponse, @Params params: RePathnameParams) {\n    res.setHeader('Accept-Language', 'en-us')\n  }\n\n  @Trace('/')\n  private trace(@Res res: ServerResponse, @Params params: RePathnameParams, @ReqBody body: TraceBody) {\n    res.body = body\n  }\n}\n\n@Suite\nclass ServerTest {\n  private app: HttpServer\n  private port: number\n\n  @SuiteSetup\n  private async setup() {\n    this.app = HttpServer.create()\n    await this.app.serve()\n    this.port = this.app.address().port\n  }\n\n  @SuiteTeardown\n  private async teardown() {\n    await this.app.close()\n  }\n\n  @Test\n  private async create() {\n    let res = await request.post(`http://127.0.0.1:${this.port}/`, {resolveWithFullResponse: true, json: true})\n    expect(res.statusCode).toBe(201)\n  }\n\n  @Test\n  private async get() {\n    let res = await request.get(`http://127.0.0.1:${this.port}/1`, {resolveWithFullResponse: true, json: true})\n    expect(res.statusCode).toBe(200)\n    expect(res.body.id).toBe(1)\n  }\n\n  @Test\n  private async update() {\n    let res = await request.put(`http://127.0.0.1:${this.port}/1/value`, {body: {value: 100}, resolveWithFullResponse: true, json: true})\n    expect(res.statusCode).toBe(200)\n    expect(res.body.value).toBe(100)\n  }\n\n  @Test\n  private async delete() {\n    let res = await request.delete(`http://127.0.0.1:${this.port}/1`, {resolveWithFullResponse: true, json: true})\n    expect(res.statusCode).toBe(200)\n    expect(res.body.id).toBe(0)\n  }\n\n  @Test\n  private async head() {\n    let res = await request.head(`http://127.0.0.1:${this.port}/`, {resolveWithFullResponse: true, json: true})\n    expect(res.statusCode).toBe(204)\n  }\n\n  @Test\n  private async options() {\n    let res = await request({method: 'OPTIONS', url: `http://127.0.0.1:${this.port}/`, resolveWithFullResponse: true, json: true})\n    expect(res.statusCode).toBe(200)\n    expect(res.headers['accept-language']).toBe('en-us')\n  }\n\n  @Test\n  private async trace() {\n    let res = await request({method: 'TRACE', url: `http://127.0.0.1:${this.port}/`, body: {value: 100}, resolveWithFullResponse: true, json: true})\n    expect(res.statusCode).toBe(200)\n    expect(res.body.value).toBe(100)\n  }\n}\n\nTestContainer.run()"]}